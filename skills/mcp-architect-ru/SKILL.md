---
name: mcp-architect-ru
description: Проектировать MCP‑сервера: инструменты (tools), ресурсы (resources), шаблоны, интеграции с Claude, безопасность и документация.
---

# MCP Architect (RU)

## Цель
Помогать спроектировать и документировать MCP-сервер (Model Context Protocol):
- определить инструменты и ресурсы,
- описать интеграции с внешними сервисами,
- продумать безопасность и аутентификацию,
- подготовить спецификацию для реализации.

## Когда использовать
- Нужен MCP-сервер для доступа к данным или API.
- Нужно описать инструменты для Claude.
- Требуется спланировать архитектуру MCP-интеграции.
- Нужно задокументировать существующий MCP-сервер.

## Общие принципы
- MCP — это мост между Claude и внешними системами.
- Инструменты = действия (выполнить запрос, создать запись).
- Ресурсы = данные (документы, файлы, записи БД).
- Безопасность: валидация, rate limits, логирование.

## Шаги работы

### 1. Уточни назначение MCP-сервера
Задай вопросы:
- Для чего MCP: доступ к БД, API, файлам?
- Какие данные нужны: документы, пользователи, заявки?
- Какие действия: поиск, создание, обновление, удаление?
- Кто будет использовать: один агент, множество агентов?

### 2. Инструменты (Tools)
Опиши каждый инструмент:

**Формат описания:**
```text
Tool: search_documents
Описание: Поиск документов по запросу
Входные параметры:
  - query (string): поисковый запрос
  - limit (number, optional): макс. результатов (default: 10)
Выходные данные:
  - results: array of {id, title, snippet, url}
Ошибки:
  - invalid_query: запрос пустой или некорректный
  - rate_limit: превышен лимит запросов
```

**Таблица инструментов:**

| Tool              | Метод    | Описание                      | Параметры              |
|-------------------|----------|-------------------------------|------------------------|
| search_docs       | POST     | Поиск документов              | query, limit, filters  |
| get_doc           | GET      | Получить документ по ID       | id                     |
| create_doc        | POST     | Создать документ              | title, content, tags   |
| update_doc        | PUT      | Обновить документ             | id, content            |
| delete_doc        | DELETE   | Удалить документ              | id                     |

### 3. Ресурсы (Resources)
Опиши доступные ресурсы:

**Формат описания:**
```text
Resource: document://{id}
Описание: Документ по его идентификатору
URI pattern: document://{id}
Метки: @document, @read
Пример: document://12345

Resource: news_feed
Описание: Лента новостей
URI: news://feed
Метки: @news, @read, @live
Обновление: каждые 5 минут
```

**Список ресурсов:**

| Resource URI     | Тип      | Описание                      | Метки              |
|------------------|----------|-------------------------------|--------------------|
| document://{id}  | dynamic  | Документ по ID                | @document, @read   |
| news://feed      | static   | Лента новостей                | @news, @live       |
| stats://summary  | static   | Статистика системы            | @stats, @read      |

### 4. Аутентификация и безопасность
Опиши механизм защиты:

**Аутентификация:**
- API ключ в заголовке `X-MCP-API-Key`
- JWT токен для пользователя
- OAuth2 для сторонних сервисов

**Авторизация:**
```python
# Пример проверки прав
def check_permissions(user, resource, action):
    if resource.startswith("admin://"):
        return user.role == "admin"
    if action in ["create", "update", "delete"]:
        return user.role in ["admin", "editor"]
    return True  # read — все
```

**Rate limiting:**
- 100 запросов/минута на пользователя
- 1000 запросов/минута на сервер
- Блокировка на 5 минут при превышении

**Валидация:**
- Все входные параметры валидировать
- SQL/NoSQL injection защита
- XSS защита для HTML-контента

### 5. Интеграции
Опиши подключения к внешним системам:

**Пример интеграции с векторной БД:**
```text
Интеграция: Qdrant Vector DB
Назначение: семантический поиск документов
Подключение:
  - Host: localhost
  - Port: 6333
  - Collection: documents
Операции:
  - search_vector(query_vector) → results
  - upsert_document(id, vector, metadata)
Обработка ошибок:
  - При недоступности: вернуть кэшированные результаты
  - При таймауте: retry 3 раза с backoff
```

### 6. Архитектура сервера
Опиши структуру:

```text
MCP Server Architecture:
├── main.py              # точка входа
├── api/
│   ├── tools.py         # обработчики инструментов
│   ├── resources.py     # обработчики ресурсов
│   └── middleware.py    # аутентификация, логирование
├── integrations/
│   ├── vector_db.py     # векторная БД
│   ├── postgres.py      # реляционная БД
│   └── external_api.py  # внешние API
├── models/
│   ├── requests.py      # Pydantic модели запросов
│   └── responses.py     # Pydantic модели ответов
└── config/
    ├── settings.py      # конфигурация
    └── logging.py       # настройка логирования
```

### 7. Спецификация для реализации
Сформируй ТЗ:

**Функциональные требования:**
- [ ] Tool: search_documents с полнотекстовым поиском
- [ ] Tool: get_document с кешированием
- [ ] Resource: document://{id} с метаданными
- [ ] Аутентификация через API ключ
- [ ] Rate limiting: 100 req/min

**Нефункциональные требования:**
- Время ответа: < 500ms (p95)
- Доступность: 99.5%
- Логирование всех запросов
- Graceful degradation при падении интеграций

**Технологии:**
- Python 3.11+
- FastAPI (веб-сервер)
- Pydantic (валидация)
- PostgreSQL (хранение)
- Redis (кеш)

## Формат вывода
1. Резюме MCP-сервера.
2. Таблица инструментов (Tools).
3. Таблица ресурсов (Resources).
4. Аутентификация и безопасность.
5. Интеграции с внешними системами.
6. Архитектура сервера.
7. ТЗ для реализации.

## Примеры запросов
- «Спроектируй MCP-сервер для доступа к базе знаний».
- «Опиши инструменты для работы с Bitrix24 через MCP».
- «Сделай спецификацию MCP-сервера для векторной БД».
